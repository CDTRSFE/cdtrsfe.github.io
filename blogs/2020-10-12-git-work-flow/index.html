<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何规范Git工作流 | 成都拓尔思前端团队</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.f6632dd8.css" as="style"><link rel="preload" href="/assets/js/app.9c141345.js" as="script"><link rel="preload" href="/assets/js/2.6a03cd93.js" as="script"><link rel="preload" href="/assets/js/12.d026b578.js" as="script"><link rel="prefetch" href="/assets/js/10.0d592072.js"><link rel="prefetch" href="/assets/js/11.db3369d9.js"><link rel="prefetch" href="/assets/js/13.dea7dbc5.js"><link rel="prefetch" href="/assets/js/14.7e95609e.js"><link rel="prefetch" href="/assets/js/15.1143cf56.js"><link rel="prefetch" href="/assets/js/16.b279700c.js"><link rel="prefetch" href="/assets/js/17.6098c2f8.js"><link rel="prefetch" href="/assets/js/18.83bcce27.js"><link rel="prefetch" href="/assets/js/19.515170a7.js"><link rel="prefetch" href="/assets/js/3.c587dd52.js"><link rel="prefetch" href="/assets/js/4.e3603d9b.js"><link rel="prefetch" href="/assets/js/5.dd66db2b.js"><link rel="prefetch" href="/assets/js/6.02057c17.js"><link rel="prefetch" href="/assets/js/7.b048b111.js"><link rel="prefetch" href="/assets/js/8.9f59f61c.js"><link rel="prefetch" href="/assets/js/9.0ba4c027.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f6632dd8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">成都拓尔思前端团队</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/" class="nav-link router-link-active">
  文章
</a></div><div class="nav-item"><a href="/blogs/2020-10-12-git-work-flow/.html" class="nav-link">
  开源项目
</a></div><div class="nav-item"><a href="/website/join/" class="nav-link">
  加入我们
</a></div><div class="nav-item"><a href="http://www.trs.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  拓尔思官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs/" class="nav-link router-link-active">
  文章
</a></div><div class="nav-item"><a href="/blogs/2020-10-12-git-work-flow/.html" class="nav-link">
  开源项目
</a></div><div class="nav-item"><a href="/website/join/" class="nav-link">
  加入我们
</a></div><div class="nav-item"><a href="http://www.trs.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  拓尔思官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>如何规范Git工作流</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/2020-10-12-git-work-flow/#pre-commit-hook" class="sidebar-link">Pre Commit Hook</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blogs/2020-10-12-git-work-flow/#代码风格检测" class="sidebar-link">代码风格检测</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blogs/2020-10-12-git-work-flow/#提交信息验证" class="sidebar-link">提交信息验证</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blogs/2020-10-12-git-work-flow/#工具" class="sidebar-link">工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/2020-10-12-git-work-flow/#提交信息格式化工具" class="sidebar-link">提交信息格式化工具</a></li><li class="sidebar-sub-header"><a href="/blogs/2020-10-12-git-work-flow/#git-changelog-生成工具" class="sidebar-link">Git ChangeLog 生成工具</a></li></ul></li><li><a href="/blogs/2020-10-12-git-work-flow/#标准" class="sidebar-link">标准</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/2020-10-12-git-work-flow/#semver-version" class="sidebar-link">Semver Version</a></li></ul></li><li><a href="/blogs/2020-10-12-git-work-flow/#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="如何规范git工作流"><a href="#如何规范git工作流" class="header-anchor">#</a> 如何规范Git工作流</h1> <h2 id="pre-commit-hook"><a href="#pre-commit-hook" class="header-anchor">#</a> Pre Commit Hook</h2> <p>在提交之前我们必须保证满足某些条件，需要安装 <code>husky</code></p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev husky
</code></pre></div><h2 id="代码风格检测"><a href="#代码风格检测" class="header-anchor">#</a> 代码风格检测</h2> <p>不同的语言和框架有不同的检测工具，比如 <code>vue</code> 我们需要在 package.json 中加入如下的脚本</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这会让所有的文件都被检测，比较耗时，而加入 <code>lint-staged</code> 可以只用检测 staged 中的文件。首先安装</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev lint-staged
</code></pre></div><p>然后 <code>pakckage.json</code> 应该被修改为</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;*.{js,vue}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;vue-cli-service lint&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;git add&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://cli.vuejs.org/zh/guide/cli-service.html#git-hook" target="_blank" rel="noopener noreferrer">参考链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="提交信息验证"><a href="#提交信息验证" class="header-anchor">#</a> 提交信息验证</h2> <blockquote><p>标准的提交信息会给我们带来很大的好处</p></blockquote> <p>安装 <a href="https://commitlint.js.org/" target="_blank" rel="noopener noreferrer"><code>commitlint</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 并初始化配置文件，执行下面的脚本</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev @commitlint/{cli,config-conventional}
echo &quot;module.exports = {extends: ['@commitlint/config-conventional']};&quot; &gt; commitlint.config.js
</code></pre></div><p>在 <code>package.json</code> 中加入配置</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commitlint -E HUSKY_GIT_PARAMS&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最终 package.json 文件就变成下面这样了</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commitlint -E HUSKY_GIT_PARAMS&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;*.{js,vue}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;vue-cli-service lint&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;git add&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><h2 id="工具"><a href="#工具" class="header-anchor">#</a> 工具</h2> <blockquote><p>很多时候我们需要通过工具来帮我们完成上面的工作</p></blockquote> <h3 id="提交信息格式化工具"><a href="#提交信息格式化工具" class="header-anchor">#</a> 提交信息格式化工具</h3> <p>1、安装 <a href="https://github.com/commitizen/cz-cli" target="_blank" rel="noopener noreferrer"><code>commitizen</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> globaly</p> <div class="language- extra-class"><pre class="language-text"><code>npm install -g commitizen
</code></pre></div><p>2、运行下面的脚本启用 Angular 风格的提交信息风格</p> <div class="language- extra-class"><pre class="language-text"><code>commitizen init cz-conventional-changelog --save-dev --save-exact
</code></pre></div><p>如果上面的脚本运行失败，你可以用下面的方式替代</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev cz-conventional-changelog
</code></pre></div><p>新增配置到 package.json</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;config&quot;: {
  &quot;commitizen&quot;: {
    &quot;path&quot;: &quot;cz-conventional-changelog&quot;
  }
}
</code></pre></div><p>3、最后我们要使用 <code>git cz</code> 来替代 <code>git commit</code> 命令。</p> <h3 id="git-changelog-生成工具"><a href="#git-changelog-生成工具" class="header-anchor">#</a> Git ChangeLog 生成工具</h3> <p>全局安装 <a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli" target="_blank" rel="noopener noreferrer"><code>conventional-changelog</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- extra-class"><pre class="language-text"><code>npm install -g conventional-changelog-cli
</code></pre></div><p>然后生成 changelog 文件 <code>CHANGELOG.md</code></p> <div class="language- extra-class"><pre class="language-text"><code>conventional-changelog -p angular -i CHANGELOG.md -s -r 0
</code></pre></div><p>把上面的命令加入到 package.json 中</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;changelog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;conventional-changelog -p angular -i CHANGELOG.md -s -r 0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>conventional-changelog</code> 只会取 <code>Feature</code>, <code>Fix</code>, <code>Performance Improvement</code> 或者 <code>Breaking Changes</code> 类型的提交。</p></div> <p>推荐的工作流</p> <ul><li>修改代码</li> <li><code>git cz</code> 提交</li> <li><code>npm version 1.x.x</code> 修改版本打Tag</li> <li><code>npm run changelog</code> 生成更新日志</li> <li><code>git cz</code> 推送更新日志 (选择 <code>docs</code> 提交类型).</li> <li><code>git push origin v1.x.x</code> 将上面的 Tag 推送到远端</li></ul> <h2 id="标准"><a href="#标准" class="header-anchor">#</a> 标准</h2> <h3 id="semver-version"><a href="#semver-version" class="header-anchor">#</a> <a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener noreferrer">Semver Version<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>示例</p> <ul><li><code>major</code>  3.1.0 -&gt; 4.0.0</li> <li><code>premajor</code> 2.1.0 –&gt; 3.0.0-0</li> <li><code>minor</code> 2.0.1 -&gt; 2.1.0</li> <li><code>prepatch</code> 3.0.0–&gt;3.0.1-0</li> <li><code>patch</code> 2.0.0-0 -&gt; 2.0.0 / 2.0.0 -&gt; 2.0.1</li></ul> <p>最佳实践</p> <ul><li>开始版本号推荐为 <code>0.1.0</code></li> <li>正式版的版本号至少应该为 <code>1.0.0</code></li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li>http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html</li> <li>https://github.com/angular/angular/blob/master/CONTRIBUTING.md</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/20/2021, 10:53:19 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9c141345.js" defer></script><script src="/assets/js/2.6a03cd93.js" defer></script><script src="/assets/js/12.d026b578.js" defer></script>
  </body>
</html>
